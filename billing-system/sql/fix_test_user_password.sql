-- ============================================================================
-- テストユーザー（Smiley0007）のパスワードハッシュ修正SQL
-- ============================================================================
-- 目的: パスワード検証が失敗する問題を修正
-- 実行日: 2025-12-20
-- 対象: テストユーザー Smiley0007
-- パスワード: password123
-- ============================================================================

-- 文字セット設定
SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci;

-- ============================================================================
-- 1. 修正前の状態確認
-- ============================================================================

SELECT
    '=== 修正前の状態 ===' as status,
    user_code,
    user_name,
    LEFT(password_hash, 30) as password_hash_preview,
    role,
    is_registered,
    is_active
FROM users
WHERE user_code = 'Smiley0007';

-- ============================================================================
-- 2. パスワードハッシュの修正
-- ============================================================================

-- テストユーザーのパスワードハッシュを正しい値に更新
-- パスワード: password123
-- ハッシュアルゴリズム: bcrypt (cost=12)
UPDATE users
SET
    password_hash = '$2y$12$LQv3c1yqBWVHxkd0LHAkCOYz6TukcvhqdVyO1N8hMp0i5GdBKqRQC',
    role = 'smiley_staff',
    is_registered = 1,
    is_active = 1,
    registered_at = NOW(),
    updated_at = NOW()
WHERE user_code = 'Smiley0007';

-- ============================================================================
-- 3. 修正後の状態確認
-- ============================================================================

SELECT
    '=== 修正後の状態 ===' as status,
    user_code,
    user_name,
    LEFT(password_hash, 30) as password_hash_preview,
    role,
    is_registered,
    is_active,
    registered_at
FROM users
WHERE user_code = 'Smiley0007';

-- ============================================================================
-- 4. ログイン情報の表示
-- ============================================================================

SELECT
    '=== ログイン情報 ===' as info,
    'Smiley0007' as user_code,
    'password123' as password,
    'smiley_staff' as role,
    'テスト管理者' as user_name;

-- ============================================================================
-- 完了メッセージ
-- ============================================================================

SELECT
    '修正完了' as status,
    'テストユーザーのパスワードハッシュを更新しました' as message,
    'ログインページでSmiley0007/password123でログインできます' as next_step;
